mkdir -p /etc/certs
mkdir -p /etc/salt-bootstrap
chmod 700 /etc/certs
chmod 700 /etc/salt-bootstrap
cat > /etc/certs/ca.pem <<EOF
-----BEGIN CERTIFICATE-----
MIICzTCCAbegAwIBAgIQOsccZqY5cLSmzUos/XUxgzALBgkqhkiG9w0BAQswEjEQ
MA4GA1UEChMHZ2F0ZXdheTAeFw0xODA4MTQxNTI3MDBaFw0yMTA3MjkxNTI3MDBa
MBIxEDAOBgNVBAoTB2dhdGV3YXkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
AoIBAQDggSVqap2whmpejWklR1s0x1uMFLN8G7d5GDPNeKjxnEWMRaC0FWfKqg67
+yfoUvD4ECuZqoOtxR97w4UEUbRdArIBPiaPCuXUwOs8/8GRv+44CkQCYRTrQ57Y
iFjCtLtz2sc223LHmxgu7DynM3QXQlKu2RbWQV5ibPuErTKHbhNdQXWWAHGMJ8l5
471jmf02UFMJCGWKPPquRxS3qZnemBl11FP9xo/iMANRPc65wb/a2eM3S95fgENo
9TaO0dzMTAqWTldoDwvdlv1+fPp8lLNJcxoD+HC3T6W4pn2nTYlVmD9Rwtcl0wxL
L48mDxELG87wOHuhGsvkFOn1UuZrAgMBAAGjIzAhMA4GA1UdDwEB/wQEAwIArDAP
BgNVHRMBAf8EBTADAQH/MAsGCSqGSIb3DQEBCwOCAQEAO2nR9xFYDsrcHptXCTcZ
LZvi42ntwwJL+OWy2EeYJGLKHug2tt26qxVgT/PVW2euWxTGNaIsG1wO1op8NWVV
ufwbe3HEg85/5Wm4hrek/9PzBwqU3EfUtWyruC91dqmQdE7lLMEb/Fg/o19lwr4f
VA6Ky8EmEomf6tdm9RPpeey+bGfkoF3awKUDrooUrrvzX7rgl+ojz8oZDui9sDs3
DQJRjAMM/2hizzYkfNI4lXODXZjSytxaywdwTn9KqTU0GYjjzWEjQJajN5UawQNy
kS/gpOXUA9+rUtsdZdsd10qeo3ZdQA1DeL+MN072cNd2kIbm3lHvcLNH7lR4n3Nv
wQ==
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cb-client.pem <<EOF
-----BEGIN CERTIFICATE-----
MIICozCCAYugAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDDApjbG91
ZGJyZWFrMB4XDTE4MDgxNDE1MzEwMFoXDTI4MDgxNDE1MzEwMFowFTETMBEGA1UE
AxMKY2xvdWRicmVhazCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALmO
Xdd+E0Mlujj3+OFEfzPU+A+0BM7VMyx++qYpo5g39OYC7TUIMRxn8DiZ+EU/bd8L
sRTizppvdVrzhs+8w3mXF7b9I307tHtlItDNL0dPzCAp7WlQY/ChIyiaOVbjvdab
8lHAZC+jrb3C1f8lbL9crF1W9LDHqShmQWIAITA+5PDUg7nY+utvha0Ooh3Jox+U
GvGthABf35n1N+WTdXTFa4uPPSRuKUSGIkbNbm4bPTKFwiLpqAghCOZYm3l5kKhd
X+wLwHiimCCFBAUL0zhPAKoiLpwO4twL6WSvt3Nh4ZjCKn87hUjgWtORuKM+Wnl9
GYpbKcpmhLREqWcpEwMCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAPO0X18MnVlVy
m2oworKZHMHxJsdwDKySgJVfHWeUXqfKuCpTdRkCegdq6J9VWE5XCYH+uvcEDLfG
Zb68WTKPRZz7c9fbsW6p+9UfYShFjf5kV2xl5JWy2XN5/8W3X6PpYEY/O6obfJ+L
YNBYOBh+8t5MAFcJKB4ElnqbVoZ5R8BAGFtT8TkfgJYELY8QGoEgTl+8ZC0vW8vU
Y3FlA1OU4N6rOQJZBczq9D8fJTk+49xZ1faO8P8bVf9630SHTg+2jHWsgKj7D4CY
1J/ADJPf71DRdvGjJA6tV5nWlhRGIb6JaPcJ43g30l5PUrZwME8Gp4dIXoPXQ87O
imUsJjEAMw==
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cluster.pem <<EOF
-----BEGIN CERTIFICATE-----
MIIDBTCCAe+gAwIBAgIQKOnbK+20R3lhcxF4D3el5TALBgkqhkiG9w0BAQswEjEQ
MA4GA1UEChMHZ2F0ZXdheTAeFw0xODA4MTQxNTI3MDBaFw0yMTA3MjkxNTI3MDBa
MBIxEDAOBgNVBAoTB2dhdGV3YXkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
AoIBAQC5Ah7KF9c+bDJNJ+4y0f6+0OeA8ucCVwf1R9GFe1ZZJm6a4FjBOsyh21ye
LTpKHTNC71iED00ymeHrNihPLlYbUB5/VuHtHidifxGxDaLEzuiFRP5DQ5Z2kxB4
nPnVq4N+GNaY5u3WBOlYxu8oBomSeSaLYVTUYQZnEstPqPLvKEp1PXlsrVnmnuye
RxjKmb+u/rIbBNsTMNeA4Fy/xHFVGgv5nF6feIsplfEPJAr8ebU6ZdkJqIzrEU0W
Wi7t7sICeZoSeKwI1S+f0ZynlIz12GsENYgXfKdmq6EH46nzGQk5ayblSUaxGCKJ
EWcQ9qNBwEhrkvlKXG6YvmINQc5fAgMBAAGjWzBZMA4GA1UdDwEB/wQEAwIAqDAd
BgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDAYDVR0TAQH/BAIwADAaBgNV
HREEEzARgglsb2NhbGhvc3SHBH8AAAEwCwYJKoZIhvcNAQELA4IBAQB+w67PhTE6
+Xu2HfEyAm8zRR4BuZIxaksNcaZfgw4/tub0nBWGXLU58YothmLvx0Prk9qmd2tu
wPfZo6LtHWoepBGT5RNjOnT3cd5ke3VXZqlkq3Dx2ISZU/P4+pDcPdqEgSuLAbZv
LhaIdtyEM2CrEZVd8LiXnLga6ehpI/YxN68gQKQ1Ga8BnvcGsV1lf9ywRfN1B0C7
zOS90QFW6qIsmcp/6U1UtGgetRRo5CMVLRwhUIpcyN0wIqfIJ1ZJy+t0g3wOpiAc
9ddo9TrbAGXhxaLbs43PhVMmlMFLUFnJeEO7ws8u5F4+faKBj3rH66o14hElDV0E
pwI6YcJ59SXr
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cluster-key.pem <<EOF
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAuQIeyhfXPmwyTSfuMtH+vtDngPLnAlcH9UfRhXtWWSZumuBY
wTrModtcni06Sh0zQu9YhA9NMpnh6zYoTy5WG1Aef1bh7R4nYn8RsQ2ixM7ohUT+
Q0OWdpMQeJz51auDfhjWmObt1gTpWMbvKAaJknkmi2FU1GEGZxLLT6jy7yhKdT15
bK1Z5p7snkcYypm/rv6yGwTbEzDXgOBcv8RxVRoL+Zxen3iLKZXxDyQK/Hm1OmXZ
CaiM6xFNFlou7e7CAnmaEnisCNUvn9Gcp5SM9dhrBDWIF3ynZquhB+Op8xkJOWsm
5UlGsRgiiRFnEPajQcBIa5L5SlxumL5iDUHOXwIDAQABAoIBAGSNxnZI5vBClkRh
Q5HTmQXVPT5Ux0H6U5T45+QI2TGzNcJv1U2Qy8/dDkXahyfpHwduV0nPl0G9aZER
6m6+3IYT0b+cVUcvcHCUZ+U3aBRX8QEeMqQUhB8GZ5lmmFON2PYcQebw/KuqF7ns
xeeXRgaaWly/FgAoi/ZRvLcbOI7LBZgbFMkHacUkLy0BQxRpDBe3bzMr3l4/oOSv
+Th84dB9mEQs92uEkhFBPLgBph54sAh8Ca+33SryNP5p4MsmRQ5Csc+RQl8lIMFv
D/19JhOy6UI8HyqQlDO0ZH6s3CWEA41kYe0XwTRZC9pObmlDUPT8GZeKebYy+BDx
I4rRWaECgYEAxU+d4l1vAEKISppYQmBeT2LE5iGjogNuG/qEH21RKwWZS+eaf57L
TdK4R6bfR/+N4xqyvoClRyxTnBqfC8GvEMINhQXK+1QYqOMqeVYDyGpD+/o5AjFt
A60+M0hsFmgAXWsumFPNNIa4B6aE6j6YxSOHWZOJQjPdCqCTdcWEGWMCgYEA8Am0
T5drwHCAKgNa18EMxveYafQu39AZNlzBgTFJ8oeCETaCHk1RlHYImM+STucyQ435
3Yivd0lIFYn702s2oqTXI40LZPssIFjmJKMWGoYrCX5DALgYVIzzP6v3XoPhJri0
cMZeYvmhrXJFlxId+U+3+uusGmDVtENOVj7LRdUCgYAwdoLAE9TsymqxcEGXZBYm
B4t3PvHzHEaSRrDnCzGxkHl7pFJVYEptPgGXT8xt4b4W9vrKQczWs3OB1yQTfioi
wpcRgj++BYTdDpbjIJZjRn6WSHpyKHOvQIETlYk+46KbT3UtYv/3E9PlxSfGZUOe
wEBBZzSCdzymnJQ7jB0LIwKBgQDE1HBSw6vLxXSS/uVC/j5n+Se12lGFnbLO7QiP
08b7ZTq2uqfACU7YGmG6TJuAr/x7gLRfgHHBswm0/8zL9KJ8hAcWU9YAHCZ27+7o
JANABLzNsAdpU4w/6MSedXkGu8WoZtUvlLpZFrII9Cc0VdrWURRgYVhi2PzkMDzQ
Y/VzcQKBgQCOxsbnDzg0GMQG+X226/8mFahna1YZNbbp/Xa59gx+ORHnEOSbACNA
xvwy2aIgNaWoXeUFE8m4q/DyXV3gNImu79xD3Wq9pVQoNWj+LNcAeir2rJ//KLaR
j9/DO9zW8981vzX5/mWsXTL1B5H2XuZchCeg97J9bpxtZR2Knr0U0g==
-----END RSA PRIVATE KEY-----
EOF
cat > /etc/salt-bootstrap/security-config.yml <<EOF
username: cbadmin
password: 1j4rblbqhuptiv9jib370p9ctc
signKey: |-
 -----BEGIN PUBLIC KEY-----
 MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2bZaCtY2J4j2XjnFB7vsEqrZnBCPTEBx00zj+Ooo29EExOflpmJgv9Kv9UD3ja4anjQuPp+rbxtiKOMFB9NUVkPJihghEoDX02Mf5B64fXUsngnSoPTAjBHsVeXFDrw/HHIxkfQapkKZ6B4SoUja11tAlZ1r6X7o+oDoKfUFv/P3OvWkU0oNbmYBbg3ksML5q0QoX+p2NTdK5RaamHmUGguj6CjKzOdAmJCtfXM8m3rSdmcdLJSaWhKHYcHVgTq9p/HLT3Vp+l4esQQ70hWNZxThDou/NYgJEcyM2/73rneCuvM2u8H8/fENu9ZqJYN3XpPdZLcHw7ayfhSEg3oD5QIDAQAB
 -----END PUBLIC KEY-----
EOF
chmod 600 /etc/salt-bootstrap/security-config.yml
chmod 600 /etc/certs/*
mkdir -p /usr/share/nginx/json/
mv /etc/nginx/sites-enabled/ssl-template /etc/nginx/sites-enabled/ssl.conf
service nginx restart

