mkdir -p /etc/certs
mkdir -p /etc/salt-bootstrap
chmod 700 /etc/certs
chmod 700 /etc/salt-bootstrap
cat > /etc/certs/ca.pem <<EOF
-----BEGIN CERTIFICATE-----
MIICzjCCAbigAwIBAgIRAIWrvZPtkwhK7wf/MObBBOEwCwYJKoZIhvcNAQELMBIx
EDAOBgNVBAoTB2dhdGV3YXkwHhcNMTgxMDE0MTg0MDAwWhcNMjEwOTI4MTg0MDAw
WjASMRAwDgYDVQQKEwdnYXRld2F5MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
CgKCAQEAsV7DiH/W7UtGAfwe3Bke0eln1Pdv8W974x5Dk5Njpl2feGHi0TbmbuoN
WubYTozPOEJRBeJ5Q+mbSK6MrB4ac9tlVIePsNegqTeLTCdGATXjsDcA8HScM1IM
4n+G5EnJ0LjbmbMFpiz4Hf7S5U8hzlvRzOasS3q7+UTdRNHPqESJR14BI0qWSmmC
SVWZUCd186yHmX6wI+hLfPMxeFJwGlxwCKGtQfRNZJjZjHoBSwyzVp9EOf/rFgK6
A/Rk2lMOW49NK3/DOQM4Rwcd9/72BZ5xvu361QLZuqezYyTfcpQMgjHfMMY6XUVV
GGF85AIM4jnRvMZUTGTVREtIvQdLLwIDAQABoyMwITAOBgNVHQ8BAf8EBAMCAKww
DwYDVR0TAQH/BAUwAwEB/zALBgkqhkiG9w0BAQsDggEBAAWv8tXqpkb9nyCIA01C
65hL5eFrmAlS2dPZlNhMMbTLO4Guhf+Xyp0aavS7B+1Kcxoz2SPv1m6WeHh3otxS
WZ/kA9U856zf+SE/m9nL9egy3lrTcLJ15AZio2Y1ThDLUvC+RY3Mz/zeswRlthJD
3uHt6SNm6FdYsZzehptha4Hf/1anvfWHSza8sx5Ks1WnlPJaMolO4kipVWriGrMv
0k6YmO7QPFbaa16NemA2osbEqdDa7du67RaPDk5MhCPvX5dS10xA/4Ex1RahA/bu
IXGSpO4UH4Q/KmwmaiRUzVR6G44U+Xu/4KjtqvM6jeCOZxn/bEmVCe2Cu8nItYdI
DxM=
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cb-client.pem <<EOF
-----BEGIN CERTIFICATE-----
MIICozCCAYugAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDDApjbG91
ZGJyZWFrMB4XDTE4MTAxNDE4NDI0NFoXDTI4MTAxNDE4NDI0NFowFTETMBEGA1UE
AxMKY2xvdWRicmVhazCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALAk
qtuM1vSyVe2mHebCshoIKm7MRk/y5JY4IB4vXE6MB2i1+OXsB7bgPKkX9MqimE8X
EJeLkETvzdNaR+hyhocSbwYKdhmXs1uabGfYjKUtUCH4Ig/4SPxrd5qR9kWjWeBo
PCr3tV7fIfToZ7mGmiuZgqY2raK+BIaan9n3cKOdfHBVaDmBeBL8iFrvrvnjhOV7
GfWLhzPfnt+UoO8gprYg1bYAjlWmtqS5neWO43bAuUvrEIL7hfUhtUGaXF5yhTD6
Q5dMTU6hTPaQv/xRHaT4PIOyIcjpDhcZG+d7SeEf/KZ3PU+NkJax54KRhvWYocd5
82eFQeHimrFSF5BJLrUCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEApX7r3BFVMfgq
+I1fg+Xxb4HZqilwAerMuaCeDYKwFVUG6i59vnPpCdmYe/Ih9gLI5vpSVttNcFDU
lIZBGlaXo4PRGFD3hyhCzHrwRscu3pPoQzxHnLMxsAZNoG+vPAxw9FIYgQWOeLLy
WALGmhcVBrMVD23/qc4f2DMPGfj7z/VpDI291SuEltQpQ3FpMB8ZJOO467ivr60d
bi8zAqwnzDjxI3e7Khha+D4Pt4hDFKf4Yn6OXWz+ArrnQDrQSemaErGa7V2aJeCf
Voqd93GhYdoC10atwd036zskgkUmpCAi0z/I977juc2IJFg7AkXF08/g2mLm2v8N
JAhyoHdgHg==
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cluster.pem <<EOF
-----BEGIN CERTIFICATE-----
MIIDBTCCAe+gAwIBAgIQLpGyon63V9OZBXLGEbdM9DALBgkqhkiG9w0BAQswEjEQ
MA4GA1UEChMHZ2F0ZXdheTAeFw0xODEwMTQxODQwMDBaFw0yMTA5MjgxODQwMDBa
MBIxEDAOBgNVBAoTB2dhdGV3YXkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
AoIBAQCloJJbJel/wX6YV8ap7kjtVRqX9RM4dqMIrLLuJBYTjLWJk3dDC64fh/E5
dxvWzthzUe+hIoq+Z1kYLlNBgQsiA1Bpc6SSXBs8BvIVwf8MIJpHqOUitoQjGMEZ
RBDlF3qchdduHIseHp60pksrLdA3QXqnyxaPFfx/A+Ha3Ko5FbaGlw1wfcSNqAbI
k8O8BrhUYeY2sGrxgPSFVX89J+a39Z/w2rYmtO6YU4OaiaLU0+emO/FfPeoXazI1
j8MPDQ/Qmc7Iy9c/UDaamqHJ/hrNFJ/oKMvuERSoRo3Q0xDtPiWuc6xHnFBjmLba
DBSU/PMkTQQsTUbVW1kQj1A0rfplAgMBAAGjWzBZMA4GA1UdDwEB/wQEAwIAqDAd
BgNVHSUEFjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwDAYDVR0TAQH/BAIwADAaBgNV
HREEEzARgglsb2NhbGhvc3SHBH8AAAEwCwYJKoZIhvcNAQELA4IBAQA/OOiHOCZz
XN+vvulWGEyCe7rnTanJe69vgIHbNh2Rqp6w9xx74k//49nUzmzqN+nYM/pifDOZ
03b9XAx4IRsj/QpJG9WmVUrVuVk7QRX4n/DZYOoTPm1A/3dfxLDea6cDQglGZaf0
1ESDd5aA6UeM7Y7fHut8jtbWaQAypUGtZnEOYGEsoL/gHGTAIOfRmLKDU+TIUKfS
1Hru74UTaDoQZa4bF/bo3j9KXqrAev+hy+y7JxQs1c4uWHfjXFYnn9AbMGsHaEeb
KwJG4qu1Y/wLZmzUCH4zq35WXC1G6Ptx1zsq/0Vz3LJjl0Tm7PC/e5gZsIZGOze/
rVUX7TyihSvF
-----END CERTIFICATE-----
EOF
cat > /etc/certs/cluster-key.pem <<EOF
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEApaCSWyXpf8F+mFfGqe5I7VUal/UTOHajCKyy7iQWE4y1iZN3
QwuuH4fxOXcb1s7Yc1HvoSKKvmdZGC5TQYELIgNQaXOkklwbPAbyFcH/DCCaR6jl
IraEIxjBGUQQ5Rd6nIXXbhyLHh6etKZLKy3QN0F6p8sWjxX8fwPh2tyqORW2hpcN
cH3EjagGyJPDvAa4VGHmNrBq8YD0hVV/PSfmt/Wf8Nq2JrTumFODmomi1NPnpjvx
Xz3qF2syNY/DDw0P0JnOyMvXP1A2mpqhyf4azRSf6CjL7hEUqEaN0NMQ7T4lrnOs
R5xQY5i22gwUlPzzJE0ELE1G1VtZEI9QNK36ZQIDAQABAoIBABj3bnhs65jFeybN
vHWrJLUZ6gtT9xTA1WyeU86QA//oawkVAJpLrXC1Vkh6SukDfx9LD5szkMSI4aZC
fWxXXm0/IKT0uK8TUUuoJF/hQWf7liYNMJUd/CcqORls6DsQYfwsNMA1b0cYCIZk
ttoIauWZajrW40yoXMpstGQAdWxrOmbvjLMfMIadvsf7wSMgq9w4OBpztuLUjvAk
swur3fTq6oOlk0d6YSa0Jw7JE2xtoGeqWlEw7goq07wGWGryR6er2TJl8Ir233f8
TkWnR92jQUanFlXqGc5mvwtNHtoIRGZB6cOeJgZKBu9xnCVGdREnCWNcHYw3jVKZ
kxTZncECgYEAzTCwvArwT5Nj/KdE5T1f88DmfkzOImAltg+TwkYwWIo6zTIMSHEj
pAHO4AZKclCmhspcU5Tn97IaMqKvFdf0OeT8peMI1Q57HcL0M32pYNuur6tOWOyi
bM8eAslff8dmW4ktaWmR0X25h5mHnLCzZPdg/ugaqg20wPnU5JVKJFUCgYEAzqPt
OGyugX+2q7vrnfkZEqgOLAKO78y9IB95W1AWA3FrVc0vodiPR5sSL1vAd4Gi7TL5
qPHs3IWvldmr4RYrMVg7AKxcFNnbEmTBWS3/bm7Xs3+syjRklSAsUJ5kxDGNgpxQ
L38ErKZh3F5HKuEwIBQynvmu5W7RBsmctLAWDdECgYAFtSgFYwyCOiha29BHzChC
IIiI1NwbCq+h29cRXWB05gtyr8S1syf5pO87PhGOEn4/W5ur24WEV1jxNaNHKUWq
4prAhos1WfzEvCqM0B8JCbNXQZ2hTZvLCQvdqfpVFJfdTfiMaRpcSHIDupqSGjwz
P8pb7NrpBg6UG573aMuyLQKBgBpH0PC/KcaAhqv6v3Gc76pmwz6nqKQo5tjCB/4s
BlCzyRHlgaxUzYwu1bY+NhE85IrEU+o/sn8tZXJqd6it2BpzfTWNtjxUpL8HH2wH
JJhX8oj6sPAaj7xDlj8+ldQ59SRqWuxffCm1E3ciamyyrRs3VmTPnoXBfUYeuBZm
2rcxAoGBAL0sCFvrVDT6bCp/jLFpArfzepmDU5IUpWTZ3+ue8GRwgj/P4Mck8PAb
wgLNnbNMP9FTGSpK7XqC/YRBstfMbKDDQedke9JvmPg3bd+0bYSa9QTKreQqOaXu
F+V+ZADLsQcXtwtdYZFIgNQGBZxNmCFrRoP4gy/6ouS8VlWdVIwt
-----END RSA PRIVATE KEY-----
EOF
cat > /etc/salt-bootstrap/security-config.yml <<EOF
username: cbadmin
password: pkdn7vkgsbpos46kfb98ctdkf
signKey: |-
 -----BEGIN PUBLIC KEY-----
 MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEApeYCcM3ODpUXdwPu8fgDv+YpLfXDc8+mxUaM5cP2Dy8ouJfJLphixmGnSmgPvWDezyptSm0/mIF/krUWs2xrkwmBD0BmVw4rbNt5opEYQHvJOyJNckX9VHswOxFydVkGfFeOpheaHWiXHkuj802CRrBNO4h1FWiXtqt7C3uHJnbezFWljaNQYHZE0agqcnR9Zm2sm5eDZZ4IyHRQQ7mIwui9DDU6kerFZebN603H0OZQFMHQVNAkA9deOsPG+Mf3kws/Pm4e23vBN9U9CUe5apkjGITVs2ea0c1e55mgO3AiIpx+/fi3mgPqs5bXM66aZpCFxF/G+cwZzUMc5ScDuwIDAQAB
 -----END PUBLIC KEY-----
EOF
chmod 600 /etc/salt-bootstrap/security-config.yml
chmod 644 /etc/certs/*
mkdir -p /usr/share/nginx/json/
mv /etc/nginx/sites-enabled/ssl-template /etc/nginx/sites-enabled/ssl.conf
service nginx restart

